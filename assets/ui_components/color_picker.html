<w-s component="color-picker" model="settings" #menu="main" export="load" element="div" class="flame_ui_panel">
    <div badge="icon" class="menu_item" onclick="((load)(`test`))" onpointerup="((load)(`test`))" style="display:none">
        COLOR
    </div>

    <canvas 
        width="150" 
        height="150"
        onmousedown="((down)())" 
        badge="color_field"
        >
        
    </canvas>

    <script on="((created))">
        this.cp = new presets.custom.classes.coloredit();
        src.ctx = src.badges.color_field.getContext("2d");
        this.cp.draw(src.ctx, 0,0,150,150,"square","hsl");
    </script>

    <script on="((down))">
        let col = this.cp.getColor(event.offsetX, event.offsetY, 150, 150, "square", "hsl");
        emit.r = col.r;
        emit.g = col.g;
        emit.b = col.b;
        emit.a = col.a / 255;
        emit.primary_color = (col.r) | (col.g << 8) | (col.b << 16) | (col.a << 24);

    </script>

    <span>R<input type="number" value="((r))"></span>
    <span>G<input type="number" value="((g))"></span>
    <span>B<input type="number" value="((b))"></span>
    <span>A<input type="number" value="((a))" min=0 max=1></span>
    <button onclick="((bg)())">background</button>
    <button onclick="((col)())">color</button>

    <script on=((target))>	
		src.target = target;
        this.cp.draw(src.ctx, 0,0,150,150,"square","hsl");
	</script>
    
    <script on="((bg))">
    let color = src.color;

    let r = color & 0xFF;
    let g = (color >> 8) & 0xFF;
    let b = (color >> 16) & 0xFF;
    let a = ((color >> 24) & 0xFF)/255;

    if (src.target)
        presets.custom.actions.SETBACKGROUNDCOLOR(presets.custom.system, src.target.element, src.target.component, r, g, b, a);
    </script>
    <script on="((col))">
    let color = src.color;

    let r = color & 0xFF;
    let g = (color >> 8) & 0xFF;
    let b = (color >> 16) & 0xFF;
    let a = ((color >> 24) & 0xFF)/255;

    if (src.target)
        presets.custom.actions.SETCOLOR(presets.custom.system, src.target.element, src.target.component, r, g, b, a);
    </script>

    <script on="((primary_color))">
    src.color = primary_color;
    </script>
    <script on="((color))">
    let out = primary_color;

    src.color = out;

    emit.r = out & 0xFF;
    emit.g = (out >> 8) & 0xFF;
    emit.b = (out >> 16) & 0xFF;
    emit.a = ((out >> 24) & 0xFF);
    </script>
    <script on="((r))">
    let color = src.color;
    emit.primary_color = (color & 0xFFFFFF00) | ((r | 0) & 0xFF);
    emit.primary_color = color;
    </script>
    <script on="((g))">
    let color = src.color;
    emit.primary_color = (color & 0xFFFF00FF) | (((g | 0) & 0xFF) << 8);
    </script>
    <script on="((b))">
    let color = src.color;
    emit.primary_color = (color & 0xFF00FFFF) | (((b | 0) & 0xFF) << 16);
    </script>
    <script on="((a))">
    let v = Math.max(Math.min((255 * a) | 0, 255), 0);
    let color = src.color;
    emit.primary_color = (color & 0xFFFFFF) | (((v | 0) & 0xFF) << 24);
    </script>
</w-s>