<!DOCTYPE html>
<html>

<head>
    <link href="../../node_modules/mocha/mocha.css" rel="stylesheet" />
    <script type="text/javascript" src="../../node_modules/chai/chai.js"></script>
    <script type="text/javascript" src="../../node_modules/mocha/mocha.js"></script>
    <script type="text/javascript" src="./data.js"></script>
    <script type="text/javascript" src="./save.js"></script>
    <script type="text/javascript" src="./move.js"></script>
    <script type="text/javascript" src="./creating.js"></script>
    <script type="text/javascript" src="./border_box.js"></script>
    <script type="text/javascript" src="./history.js"></script>
    <script type="text/javascript" src="./unsorted.js"></script>
</head>

<body>
    <div id="mocha"></div>
    <script>
    function run(system) {

        mocha.setup("bdd");
        chai.should();

        function loadDoc(uri) {
            system.docs.loadFile(uri);
            let doc = system.docs.get(uri);
            doc.should.not.equal(undefined);
            return doc;
        }

        function loadComponent(uri) {
            const doc = loadDoc(uri);
            return new Promise(res => {
                doc.bind({
                    documentReady: data => {
                        const comp = system.actions.CREATE_COMPONENT(system, doc, 20, 20);
                        //There's a slight delay as a component is loaded into the UI. 
                        setTimeout(function() {
                            return res({ doc, data, comp });
                        }, 100);

                        return false;
                    }
                });
            });
        }

        const env = {
            tO : (interval = 50) => new Promise(res => setTimeout(res, interval)),
            loadTestComponentA: () => loadComponent(path.resolve("test/component/test_compA.html")),
            loadTestComponentB: () => loadComponent(path.resolve("test/component/test_compB.html"))
        };

        /** Loading Test Modules **/
        //DATA(system, env);
        //MOVE(system, env);
        //BB(system, env);
        CREATION(system, env);
        //HISTORY(system, env);
        //UNSORTED(system, env);

        mocha.checkLeaks();
        mocha.run();
    }

    window.run = run;
    </script>
</body>

</html>
